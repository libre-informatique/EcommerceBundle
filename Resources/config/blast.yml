# Copyright (C) 2015-2016 Libre Informatique
#
# This file is licenced under the GNU GPL v3.
# For the full copyright and license information, please view the LICENSE
# file that was distributed with this source code.

parameters:
    blast:

##########
# PRODUCT
##########

        Librinfo\EcommerceBundle\Entity\Product:
            Sonata\AdminBundle\Show\ShowMapper:
                forceTabs: true
                add:
                    form_group_general:
                        '':
                            name:
                                label: librinfo.label.product_name
                            slug:
                                label: librinfo.label.product_shop_url
                                template: "LibrinfoEcommerceBundle:ProductAdmin:show_field_shop_link.html.twig"
                            code:
                                label: librinfo.label.product_code
                            enabled: boolean
                            description: ~
                            options:
                                label: librinfo.label.product_options
                            shortDescription: ~
                            metaKeywords: ~
                            metaDescription: ~
                        show_group_availability:
                            available:
                                type: boolean
                            availableOn: ~
                            availableUntil: ~
                    show_tab_variants:
                        '':
                            variants:
                                admin_code: librinfo_ecommerce.admin.product_variant
                    form_tab_history:
                        form_group_history:
                            createdAt: ~
                            updatedAt: ~
                    _options:
                        tabsOrder: [form_group_general, show_tab_variants, form_tab_history]

            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_general:
                        '':
                            name:
                                type: text
                                label: librinfo.label.product_name
                            slug:
                                type: text
                            code:
                                label: librinfo.label.product_code
                            enabled: boolean
                            description:
                                type: textarea
                                required: false
                            shortDescription:
                                type: textarea
                                required: false
                            metaKeywords:
                                type: text
                                required: false
                            metaDescription:
                                type: textarea
                                required: false
                            options:
                                label: librinfo.label.product_options
                                required: false
                            availableOn:
                                type: sonata_type_datetime_picker
                                required: false
                                dp_use_current: false
                                dp_pick_time: true
                            availableUntil:
                                type: sonata_type_datetime_picker
                                required: false
                                dp_use_current: true
                                dp_pick_time: true
                    form_tab_variants:
                        '':
                            variants:
                                type: sonata_type_collection
                                label: false
                                by_reference: false
                                type_options:
                                    btn_add: false
                                    delete_options:
                                        type: checkbox
                                        type_options:
                                            mapped: false
                                            required: false
                                required: true    # if not true, child form fields cannot be required (why ??)
                                _options:
                                    edit: inline
                                    inline: table
                                    admin_code: librinfo_ecommerce.admin.product_variant
                    _options:
                        tabsOrder: [form_group_general, form_tab_history]

            Sonata\AdminBundle\Datagrid\ListMapper:
                add:
                    name:
                        identifier: true
                        label: librinfo.label.product_name
                    code:
                        identifier: true
                        label: librinfo.label.product_code
                    enabled:
                        type: boolean
                    available:
                        type: boolean
                    _options:
                        fieldsOrder:
                            - code
                            - name
                            - enabled
                            - available
                    _actions:
                        shop_link:
                            template: 'LibrinfoEcommerceBundle:CRUD:list__action_shop_link.html.twig'
                        variants:
                            template: 'LibrinfoEcommerceBundle:CRUD:list__action_variants.html.twig'
                    _export_formats:
                        csv: [code, name, available]
                        xls: csv
                        json: csv
                        xml: csv
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    translations.name:
                        label: librinfo.label.product_name
                    code:
                        label: librinfo.label.product_code
                    translations.description:
                        label: librinfo.label.description
                    translations.shortDescription:
                        label: librinfo.label.short_description
                    translations.metaKeywords:
                        label: librinfo.label.meta_keywords
                    translations.metaDescription:
                        label: librinfo.label.meta_description
                    enabled: ~
#                    available: ~
                    _options:
                        fieldsOrder:
                            - code
                            - translations.name


##################
# PRODUCT VARIANT
##################

        Librinfo\EcommerceBundle\Entity\ProductVariant:
            # SHOW
            Sonata\AdminBundle\Show\ShowMapper:
                forceTabs: true
                add:
                    form_group_general:
                        '':
                            product:
                                admin_code: librinfo_ecommerce.admin.product
                            name:
                                label: librinfo.label.product_variant_name
                            code:
                                label: librinfo.label.product_variant_code
                            price: ~
                            optionValues:
                                template: 'LibrinfoEcommerceBundle:ProductVariantAdmin:show_field_optionvalues.html.twig'

                        show_group_stock:
                            onHand: ~
                            onHold: ~
                            tracked:
                                type: boolean
                                label: librinfo.label.tracked_stock
                        show_group_availability:
                            available:
                                type: boolean
                            availableOn: ~
                            availableUntil: ~
                        show_group_properties:
                            width: ~
                            height: ~
                            depth: ~
                            weight: ~
                    form_tab_history:
                        form_group_history:
                            createdAt: ~
                            updatedAt: ~
                    _options:
                        tabsOrder: [form_group_general, form_tab_history]
            # FORM
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_general:
                        '':
                            product:
                                type: sonata_type_model_autocomplete
                                property: [translations.name, code]
                                read_only: true
                                _options:
                                    admin_code: librinfo_ecommerce.admin.product
                            name:
                                label: librinfo.label.product_variant_name
                            code:
                                label: librinfo.label.product_variant_code
                            price: ~
                            optionValues:
                                property: fullName
                                _options:
                                    admin_code: librinfo_ecommerce_option_value.admin.product
                            _options:
                                fieldsOrder: [product, name, code, price, optionValues]
                        form_group_stock:
                            onHand:
                                required: false
                            onHold:
                                required: false
                            tracked:
                                label: librinfo.label.tracked_stock
                        form_group_availability:
                            availableOn:
                                type: sonata_type_datetime_picker
                                required: false
                                dp_use_current: false
                                dp_pick_time: true
                            availableUntil:
                                type: sonata_type_datetime_picker
                                required: false
                                dp_use_current: true
                                dp_pick_time: true
                        form_group_properties:
                            width: ~
                            height: ~
                            depth: ~
                            weight: ~
                    _options:
                        tabsOrder: [form_group_general, form_tab_history]
            # LIST
            Sonata\AdminBundle\Datagrid\ListMapper:
                add:
                    code:
                        identifier: true
                        label: librinfo.label.product_variant_code
                    name:
                        identifier: true
                        label: librinfo.label.product_variant_name
                    product:
                        admin_code: librinfo_ecommerce.admin.product
                    available:
                        type: boolean
                    price: ~
                    optionValues:
                        associated_property: fullCode
                    onHand: ~
                    onHold: ~
                    tracked:
                        type: boolean
                        label: librinfo.label.tracked_stock
                    _options:
                        fieldsOrder:
                            - code
                            - name
                            - product
                            - available
                            - price
                            - optionValues
                            - onHand
                            - onHold
                            - tracked
                    _export_formats:
                        csv: [code, name, available]
                        xls: csv
                        json: csv
                        xml: csv
            # FILTER
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    name:
                        label: librinfo.label.product_variant_name
                    code:
                        label: librinfo.label.product_variant_code
                    product.code: ~
                    _options:
                        fieldsOrder:
                            - name
                            - code
                            - product.code



####################
# PRODUCT ATTRIBUTE
####################

        Sylius\Component\Product\Model\ProductAttribute:
            # SHOW
            Sonata\AdminBundle\Show\ShowMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            name: ~
                            type: ~
                    show_tab_history:
                        show_group_history:
                            createdAt: ~
                            updatedAt: ~
            # FORM
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            name:
                                type: text
                            type:
                                type: Sylius\Bundle\AttributeBundle\Form\Type\AttributeTypeChoiceType
            # LIST
            Sonata\AdminBundle\Datagrid\ListMapper:
                add:
                    code: ~
                    name: ~
                    type: ~
            # FILTERS
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    code: ~
                    translations.name:
                        label: librinfo.label.name
                    type: ~
                    storageType: ~
                    createdAt: ~
                    updatedAt: ~

####################
# PRODUCT OPTION
####################

        Librinfo\EcommerceBundle\Entity\ProductOption:
            # SHOW
            Sonata\AdminBundle\Show\ShowMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            name: ~
                            values:
                                admin_code: librinfo_ecommerce_option_value.admin.product
                    show_tab_history:
                        show_group_history:
                            createdAt: ~
                            updatedAt: ~
            # FORM
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            name:
                                type: text
                            values:
                                type: sonata_type_collection
#                                by_reference: false
                                type_options:
                                    btn_add: false
                                    delete_options:
                                        type: checkbox
                                        type_options:
                                            mapped: false
                                            required: false
                                required: true    # if not true, child form fields cannot be required (why ??)
                                _options:
                                    edit: inline
                                    inline: table
                                    admin_code: librinfo_ecommerce_option_value.admin.product

            # LIST
            Sonata\AdminBundle\Datagrid\ListMapper:
                add:
                    code:
                        identifier: true
                    name:
                        identifier: true
            # FILTERS
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    code: ~
                    translations.name:
                        label: librinfo.label.name
                    createdAt: ~
                    updatedAt: ~


####################
# PRODUCT OPTION VALUE
####################

        Librinfo\EcommerceBundle\Entity\ProductOptionValue:
            # SHOW
            Sonata\AdminBundle\Show\ShowMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            value: ~
                            option:
                                label: librinfo.label.product_option
            # FORM
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_general:
                        '':
                            code: ~
                            value:
                                type: text
                            option:
                                label: librinfo.label.product_option
            # LIST
            Sonata\AdminBundle\Datagrid\ListMapper:
                add:
                    code:
                        identifier: true
                    value: ~
                    option:
                        label: librinfo.label.product_option
            # FILTERS
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    code: ~
                    translations.value:
                        label: librinfo.label.value
########################
# USER BUNDLE OVERRIDES
########################
        Librinfo\UserBundle\Entity\Traits\Traceable:
            Sonata\AdminBundle\Show\ShowMapper:
                add:
                    form_tab_history:
                        form_group_history:
                            createdBy: ~
                            updatedBy: ~
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_tab_history:
                        form_group_history:
                            createdBy:
                                type: entity
                                class: Librinfo\EcommerceBundle\Entity\AdminUser
                                read_only: true
                                disabled: true
                                required: false
                            updatedBy:
                                type: entity
                                class: Librinfo\EcommerceBundle\Entity\AdminUser
                                read_only: true
                                disabled: true
                                required: false

        Librinfo\UserBundle\Entity\Traits\Ownable:
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    createdBy: ~
                    updatedBy: ~
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    form_group_specifics:
                        form_group_misc:
                            owner:
                                type: entity
                                class: Librinfo\EcommerceBundle\Entity\AdminUser
                                required: false

#######################
# CRM bundle overrides
######################
        Librinfo\CRMBundle\Admin\OrganismAdmin:
            form_theme:
                - LibrinfoEcommerceBundle:OrganismAdmin:theme.html.twig
            Sonata\AdminBundle\Show\ShowMapper:
                forceTabs: true
                remove:
                    positions: ~
                    description: ~
                    phones: ~
                    email: ~
                    emailNpai: ~
                    emailNoNewsletter: ~
                    vcard_uid: ~
                    address: ~
                    zip: ~
                    city: ~
                    country: ~
                    npai: ~
                add:
                    form_group_general:
                        '':
                            active: ~
                            isCustomer:
                                template: 'LibrinfoCRMBundle:CRUD:show_field_customer.html.twig'
                            isSupplier:
                                template: 'LibrinfoCRMBundle:CRUD:show_field_supplier.html.twig'
                            category.name: ~
                            url: ~
                            description:
                                label: librinfo.label.organism_description
                            email:
                                template: 'LibrinfoCRMBundle:CRUD:show_field_email.html.twig'
                            _options:
                                fieldsOrder:
                                    - name
                                    - isCustomer
                                    - isSupplier
                                    - circles
                                    - category.name
                                    - description
                                    - email
                                    - url
                        form_group_main_address:
                            fulltext_address:
                                template: LibrinfoCRMBundle:CRUD:show_field_fulltext_address.html.twig
                                label: librinfo.label.main_address
                        form_group_phones:
                            phones: ~
                        form_group_administrative:
                            vat:
                                template: 'LibrinfoCRMBundle:CRUD:show_field_vat.html.twig'
                            iban: ~
                        _options:
                            groupsOrder:
                                - ''
                                - form_group_main_address
                                - form_group_phones
                                - form_group_administrative
                    form_group_contacts:
                        '':
                            positions:
                                associated_property: organismDescription
                                label: librinfo.label.contacts
                                template: 'LibrinfoCRMBundle:CRUD:show_field_organism_positions.html.twig'
                                cascade_validation: true
    #                                admin_code: test_code
                            _options:
                                class: positions-box
                        _options:
                            #TODO tabs descriptions should be translated (improve Sonata Admin)
                            description: "Liste des Contacts appartenant à ce Tiers"
                    form_tab_info:
                        '':
                            source:
                                type: blast_custom_choice
                                choices_field: organism.source
                                blast_choices: [Catalogue, Foire, Ami, Internet, Magazine]
                                required: false
                                attr:
                                    class: new-line
                                    width: 30
                            catalogue_sent: ~
                            catalogue_send_mean: ~
                            first_catalogue_sent_date: ~
                            last_catalogue_sent_date: ~
                    _options:
                        tabsOrder:
                            - form_group_general
                            - form_tab_info
                            - form_group_contacts
                            - form_group_specifics
                    _helper_links:
                        - url: https://framacalc.org/libio_validation_crm
                          title: Framacalc de validation
                          class: framacalc
            Sonata\AdminBundle\Form\FormMapper:
                remove:
                    address: ~
                    zip: ~
                    city: ~
                    country: ~
                    npai: ~
                add:
                    form_tab_address_book:
                        form_group_default_address:
                            defaultAddress:
                                type: text
                                disabled: true
                                label: false
                        form_group_addresses:
                            addresses:
                                type: sonata_type_collection
                                label: false
                                by_reference: false
                                required: true
                                _options:
                                    sortable: updatedAt
                                    edit: inline
                        _options:
                            groupsOrder:
                                - form_group_default_address
                                - form_group_addresses
                    _options:
                        tabsOrder:
                            - form_group_general
                            - form_tab_address_book
                            - form_group_contacts
                            - form_tab_info
                            - form_group_specifics

            Sonata\AdminBundle\Datagrid\ListMapper:
                remove:
                    createdAt: ~
                    zip: ~
                    country: ~
                    email: ~
                add:
                    name:
                        identifier: true
                        label: librinfo.label.list_organism_name
                    city: ~
                    customerCode:
                        template: LibrinfoCRMBundle:OrganismAdmin:list_field_customer.html.twig
                    supplierCode:
                        template: LibrinfoCRMBundle:OrganismAdmin:list_field_supplier.html.twig
                    category.name: ~
                    circles: ~
                    alert: ~
                    active: ~
                    _options:
                        fieldsOrder:
                            - name
                            - customerCode
                            - supplierCode
                            - city
                            - category.name
                            - circles
                            - alert
                            - active
                    _export_formats:
                        csv: [name, address, zip, city, country, alert, email, url, category, administrativeNumber, description, createdAt, updatedAt, vcardUid, npai, emailNpai, emailNoNewsletter, phones]
                        xls: csv
                        json: csv
                        xml: csv
                        vcard: [name, address, zip, city, country, email, url, description, phones, personal]
                    _helper_links:
                        - url: https://framacalc.org/libio_validation_crm
                          title: Framacalc de validation
                          class: framacalc
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    active: ~
                    name:
                        label: librinfo.label.organism_name_filter
                    positions.contact.name:
                        type: doctrine_orm_callback
                        callback: [Librinfo\CRMBundle\Admin\OrganismAdmin, contactFilterQueryBuilder]
                        label: librinfo.label.organism_contact_filter
                    category: ~
                    isCustomer: ~
                    customerCode: ~
                    isSupplier: ~
                    supplierCode: ~
                    circles: ~
                    alert: ~
                    _options:
                        fieldsOrder:
                            - name
                            - positions.contact.name
                            - category
                            - isCustomer
                            - customerCode
                            - isSupplier
                            - supplierCode
                            - circles
                            - alert

########
# ORDER
########

        Sylius\Component\Core\Model\Order:
            # SHOW
            Sonata\AdminBundle\Show\ShowMapper:
                add:
                    main_tab:
                        main_group:
                            number: ~
                            notes: ~
                            state: ~
                            checkoutCompletedAt: ~
                            itemsTotal: ~
                            adjustmentsTotal: ~
                            total: ~
                            createdAt: ~
                            updatedAt: ~
                            currencyCode: ~
                            exchangeRate: ~
                            localeCode: ~
                            checkoutState: ~
                            paymentState: ~
                            shippingState: ~
                            tokenValue: ~
                            customerIp: ~
                            id: ~

            # FORM
            Sonata\AdminBundle\Form\FormMapper:
                add:
                    main_tab:
                        main_group:
                            number: ~
                            notes: ~
                            state: ~
                            checkoutCompletedAt: ~
                            itemsTotal: ~
                            adjustmentsTotal: ~
                            total: ~
                            createdAt: ~
                            updatedAt: ~
                            currencyCode: ~
                            exchangeRate: ~
                            localeCode: ~
                            checkoutState: ~
                            paymentState: ~
                            shippingState: ~
                            tokenValue: ~
                            customerIp: ~
                            id: ~

            # LIST
            Sonata\AdminBundle\Datagrid\ListMapper:
                remove:
                    _actions: [edit, duplicate]
                    _batch_actions: [delete]
                    _list_actions: [create]
                add:
                    number:
                        label: librinfo.label.order_number
                        identifier: true
                    createdAt: ~
                    updatedAt: ~
                    channel:
                        label: librinfo.label.order_channel
                    customer:
                        admin_code: librinfo_ecommerce.admin.customer
                    notes: ~
                    state:
                        label: librinfo.label.order_state
                        template: 'LibrinfoEcommerceBundle:OrderAdmin:list_field_state.html.twig'
                    #checkoutState: ~
                    paymentState:
                        template: 'LibrinfoEcommerceBundle:OrderAdmin:list_field_payment_state.html.twig'
                    shippingState:
                        template: 'LibrinfoEcommerceBundle:OrderAdmin:list_field_shipping_state.html.twig'
                    total:
                        type: text
                        label: librinfo.label.order_total
                        template: 'LibrinfoEcommerceBundle:OrderAdmin:list_field_total.html.twig'
                    _actions:
                        delete:
                            template: LibrinfoEcommerceBundle:OrderAdmin:list__action_delete.html.twig

            # FILTERS
            Sonata\AdminBundle\Datagrid\DatagridMapper:
                add:
                    number:
                        label: librinfo.label.order_number
                    customer.name: ~
                    customer.customerCode: ~
                    notes: ~
                    state:
                        label: librinfo.label.order_state
                        type: doctrine_orm_string
                        field_type: librinfo_type_order_state
                        field_options:
                            no_cart: true
                    paymentState:
                        type: doctrine_orm_string
                        field_type: librinfo_type_payment_state
                        field_options:
                            no_cart: true
                    shippingState:
                        type: doctrine_orm_string
                        field_type: librinfo_type_shipping_state
                        field_options:
                            no_cart: true
                    itemsTotal: ~
                    # TODO euros to cents transformer:
                    adjustmentsTotal: ~
                    # TODO euros to cents transformer:
                    total:
                        label: librinfo.label.order_total
                    # TODO doctrine_orm_date:
                    createdAt:
                        type: doctrine_orm_date
                        field_type: sonata_type_date_picker
                    # TODO doctrine_orm_date:
                    updatedAt:
                        type: doctrine_orm_date
                        field_type: sonata_type_date_picker
                    # TODO doctrine_orm_date:
                    checkoutCompletedAt:
                        type: doctrine_orm_date
                        field_type: sonata_type_date_picker
                    customerIp: ~
